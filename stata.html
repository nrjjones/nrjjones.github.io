<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>stata.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Nathan R Jones</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="R.html">o[R]ientation</a>
</li>
<li>
  <a href="org.html">o[R]ganization</a>
</li>
<li>
  <a href="stata.html">Stata [R]osetta Stone</a>
</li>
<li>
  <a href="http://github.com/nrjjones/BuildingContextualData">Building Contextual Data</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="cv.html">CV</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="contact.html">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/nrjjones">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="stata-rosetta-stone" class="section level1">
<h1>Stata Rosetta Stone</h1>
<p>It takes time to start thinking like an R programmer instead of a Stata programmer. This section shows how to do some common Stata tasks using R.</p>
</div>
<div id="working-with-data-in-general" class="section level1">
<h1>Working with data in general</h1>
<p>Unlike Stata, you can have multiple datasets open at the same time in R. Unfortunately, this flexibily requires you to state <em>explicitly</em> where the variables are every time you use them. For example, if you have a sample file with personal information and another data file with survey responses, you might load both data files with the names <strong>sample</strong> and <strong>survey</strong>. If you have linking variable in both called <strong>ID</strong>, you refer to them with the data frame name then a dollar sign ($) and then the variable like this: <strong>sample$ID</strong> or <strong>survey$ID</strong>.</p>
<p>In addition to their names, you can access variables by their column number in brackets. For example, if ID is the first column in both data files, you could type <strong>sample[1]</strong> or <strong>survey[1]</strong> instead of the <strong>$ID</strong> format used above. You can also use quoted variable names in brackets if the variable name has spaces, for example, <strong>sample[‘street address line 1’]</strong>.</p>
<p>If you are only using one data file for your project, most of the R world finds it convenient to use the abbreviation <strong>df</strong>, short for <em>dataframe</em>, for the main data file. If you need to load multiple data files, use the shortest reference name you can to reduce your typing burden. For example, you can save some extra typing by using <strong>sur</strong> instead of <strong>survey</strong> and <strong>sam</strong> instead of <strong>sample</strong>.</p>
</div>
<div id="recoding-data" class="section level1">
<h1>Recoding data</h1>
<div id="simple-recoding-and-if-statements" class="section level2">
<h2>Simple recoding and IF statements</h2>
<p>Stata code requires conditional statements after the action. For example:</p>
<blockquote>
<p>replace state = “GA” if state == “Georgia”</p>
</blockquote>
<p>R has a convention of putting the condition in brackets attached to the dataframe and variable name. The following code can be interpreted as ’For the variable <strong>state</strong> in the dataframe <strong>df</strong>, when the variable <strong>state</strong> in <strong>df</strong> equals “Georgia”, replace the value with “GA”.</p>
<pre class="r"><code>   df$state[df$state==&quot;Georgia&quot;] &lt;- &quot;GA&quot;  </code></pre>
<p>An example with more more than one condition:</p>
<pre class="r"><code>   df$salutation[df$md_degree==&quot;Yes&quot; | df$educ==&quot;PhD&quot;] &lt;- &quot;Dr. &quot;  </code></pre>
</div>
<div id="complex-recoding-data" class="section level2">
<h2>Complex recoding data</h2>
<p>If you need to do more complex recoding, use case_when() from dplyr:</p>
<pre class="r"><code>df$state &lt;- case_when(  
    df$state == &quot;Georgia&quot; ~ &quot;GA&quot;,  
    df$state == &quot;Florida&quot; ~ &quot;FL&quot;,  
    df$state == &quot;Wisconsin&quot; ~ &quot;WI&quot;,  
    df$state == &quot;Wyoming&quot; ~ &quot;WY&quot;,  
    )</code></pre>
</div>
</div>
<div id="loops" class="section level1">
<h1>Loops</h1>
<div id="vectorized-apply-vs-for-loop" class="section level2">
<h2>Vectorized apply vs for loop</h2>
<p>Stata users are very familiar with a range of loop functions (foreach, forval, etc). You can write loops in R, but some problems that loops solve in Stata are better handled by vectorized code in R.</p>
<p>Some resources:</p>
<ul>
<li><a href="https://www.datacamp.com/community/tutorials/tutorial-on-loops-in-r">A Tutorial on Loops in R</a><br />
</li>
<li><a href="http://www.noamross.net/blog/2014/4/16/vectorization-in-r--why.html">Vectorization in R: Why?</a><br />
</li>
<li><a href="http://alyssafrazee.com/2014/01/29/vectorization.html">Let’s talk about vectorization</a><br />
</li>
<li><a href="https://swcarpentry.github.io/r-novice-inflammation/15-supp-loops-in-depth/">Loops in R</a></li>
</ul>
<p>Placeholder for get() to approximate for loop functionality</p>
</div>
</div>
<div id="merging-data" class="section level1">
<h1>Merging data</h1>
<ul>
<li><p><strong>full_join() </strong> - similar to merge, but no _merge variable is created. Consider installing <strong>tidylog</strong> or running your own checks to produce a variable similar _merge</p></li>
<li><p><strong>left_join() </strong> - similar to merge, then keep the _merge==3</p></li>
<li><p><strong>anti_join() </strong> - similar to merge, then keep the _merge==1 | _merge==2</p></li>
</ul>
<div id="reshaping-data" class="section level2">
<h2>Reshaping Data</h2>
<p>Many of R’s popular graphing and mapping tools prefer data to be in long format. Hadley Wickham has <a href="https://vita.had.co.nz/papers/tidy-data.pdf">written eloquently</a> about why long data, or <em>tidy</em> data, has many advantages. If you frequently work with social science data files that tend to be stored in wide files, Knowing how to reshape your data is an essential skill.</p>
<div id="wide-to-long" class="section level3">
<h3>Wide to long</h3>
<p>See <a href="https://stats.idre.ucla.edu/stata/modules/reshaping-data-wide-to-long/">here</a> for a good example of reshaping wide data to long format.</p>
<p>Wide format</p>
<pre class="r"><code>id      inc96      inc97      inc98   
1003    75000      76000      77000    
1004    40000      40500      41000    
1005    45000      45400      45800    </code></pre>
<p>Long format</p>
<pre class="r"><code>id        year    inc 
1003      96      40000  
1003      97      40500  
1003      98      41000  
1004      96      45000  
1004      97      45400  
1004      98      45800  
1005      96      75000  
1005      97      76000  
1005      98      77000 </code></pre>
<p>Stata’s reshape command</p>
<p>Stata parses the variable name to separate inc97 into the year and the income value.</p>
<pre class="r"><code>reshape long inc, i(id) j(year) </code></pre>
<p>gather() from the <strong>tidyr</strong> package works very similarly, but leaves the value of year as inc97, etc. You can change these to a year value after.</p>
<pre class="r"><code>df_long &lt;- gather(df, year, inc, -id)

# To leave 96, but as a character variable
df_long &lt;- str_remove(df_long$year, &quot;inc&quot;)

# To leave 96 as a number
df_long &lt;- as.numeric(str_remove(df_long$year, &quot;inc&quot;)) 

# To leave 1996 as a number
df_long &lt;- as.numeric(str_remove(df_long$year, &quot;inc&quot;))+1900 </code></pre>
</div>
<div id="long-to-wide" class="section level3">
<h3>Long to wide</h3>
<p>Stata</p>
<pre class="r"><code>reshape wide age, i(id)  j(year) </code></pre>
<p>spread() from the tidyr package</p>
<pre class="r"><code>df_wide &lt;- spread(df_long, year, inc)

# But this leaves the column names as 96, 97, 98. To rename:
names(df_wide) &lt;- c(&quot;id&quot;, &quot;inc96&quot;, &quot;inc97&quot;, &quot;inc98&quot;)</code></pre>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
